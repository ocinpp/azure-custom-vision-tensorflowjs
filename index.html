<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Object Detection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body {
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="scripts/tf.min.js"></script>
    <script src="scripts/custom_vision.js?v=1"></script>
</head>
<body>
    <div>
      <button id="fileSelect">
        <i class="material-icons">photo</i><span style="vertical-align:20%; font-size:2em">Photo</span>
      </button>
      <input type="file" id="fileElem" accept="image/*" style="display:none" onchange="handleFiles(this.files)">
    </div>
    <div>
      Photo
    </div>
    <canvas id="myCanvas" style="border:1px solid #d3d3d3;"></canvas>
    <div id="fileList">
      <p>No files selected!</p>
    </div>
</body>
<script>
    const IMG_URL = 'images/mata.jpg';
    const fileList = document.getElementById("fileList");
    const maxWidth = document.body.clientWidth;
    // let glDim = 0;
    let model;

    const fileSelect = document.getElementById("fileSelect"),
    fileElem = document.getElementById("fileElem");

    fileSelect.addEventListener("click", function (e) {
      if (fileElem) {
        fileElem.click();
      }
    }, false);

    function resizeAndDrawImage(c, ctx, img) {
      let canvasResizeRatio = 1;
      // let imageResizeRatio = 1;

      if (img.width > maxWidth) {
        canvasResizeRatio = maxWidth / img.width;
      }

      // alert(img.width);
      // alert(img.height);

      // if (img.width > img.height && img.width > glDim) {
      //   imageResizeRatio = glDim / img.width;
      // }

      // if (img.height > img.width && img.height > glDim) {
      //   imageResizeRatio = glDim / img.height;
      // }

      c.width = img.width * canvasResizeRatio;
      c.height = img.height * canvasResizeRatio;

      img.width = c.width;
      img.height = c.height;

      ctx.drawImage(img, 0, 0, c.width, c.height);
    }

    // handle user selected images
    function handleFiles(files) {
      if (!files.length) {
        fileList.innerHTML = "<p>No files selected!</p>";
      } else {
        fileList.innerHTML = "";
        const listElement = document.createElement("div");
        fileList.appendChild(listElement);

        // const imgElement = document.createElement("img");
        // imgElement.src = window.URL.createObjectURL(files[0]);
        // imgElement.height = 60;
        // imgElement.onload = function() {
        //   window.URL.revokeObjectURL(this.src);
        // }
        // listElement.appendChild(imgElement);

        const infoElement = document.createElement("div");
        infoElement.innerHTML = "Name: " + files[0].name;
        listElement.appendChild(infoElement);

        const infoElement2 = document.createElement("div");
        infoElement2.innerHTML = "Size: " + files[0].size + " bytes";
        listElement.appendChild(infoElement2);

        const c = document.getElementById("myCanvas");
        const ctx = c.getContext("2d");
        var img = new Image();
        img.src = window.URL.createObjectURL(files[0]);

        img.addEventListener("load", function() {
          const infoElement3 = document.createElement("div");
          infoElement3.innerHTML = "Dimension: " + img.width + " x " + img.height;
          listElement.appendChild(infoElement3);

          resizeAndDrawImage(c, ctx, img);
          detectObject(model, ctx, img);
        }, false);
      }
    }

    // load the tensorflow model
    async function init() {
      // const c = document.getElementById("myCanvas");
      // const ctx = c.getContext("2d");
      // var img = new Image();
      // img.src = IMG_URL;

      // img.addEventListener("load", function() {
      //   c.width = img.width;
      //   c.height = img.height;
      //   ctx.drawImage(img, 0, 0);
      // }, false);

      // const c = document.createElement("canvas");
      // const gl = c.getContext('webgl');
      // glDim = gl.getParameter(gl.MAX_TEXTURE_SIZE);
      // glDim = glDim / 2;

      model = await loadModel();

      // detectObject(model, ctx, img);
    }

    init();
</script>
</html>