<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Object Detection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body {
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
    </style>
    <script src="scripts/tf.min.js"></script>
    <script src="scripts/custom_vision.js?v=1"></script>
</head>
<body>
    <canvas id="myCanvas" style="border:1px solid #d3d3d3;"></canvas>
    <div>
      <input type="file" id="input" accept="image/*" onchange="handleFiles(this.files)">
    </div>
    <div>&nbsp;</div>
    <div id="fileList">
      <p>No files selected!</p>
    </div>
</body>
<script>
    const IMG_URL = 'images/mata.jpg';
    const fileList = document.getElementById("fileList");
    let model;

    // handle user selected images
    function handleFiles(files) {
      if (!files.length) {
        fileList.innerHTML = "<p>No files selected!</p>";
      } else {
        fileList.innerHTML = "";
        const listElement = document.createElement("div");
        fileList.appendChild(listElement);

        const imgElement = document.createElement("img");
        imgElement.src = window.URL.createObjectURL(files[0]);
        imgElement.height = 60;
        imgElement.onload = function() {
          window.URL.revokeObjectURL(this.src);
        }
        listElement.appendChild(imgElement);
        const infoElement = document.createElement("span");
        infoElement.innerHTML = " " + files[0].name + ": " + files[0].size + " bytes";
        listElement.appendChild(infoElement);

        const c = document.getElementById("myCanvas");
        const ctx = c.getContext("2d");
        var img = new Image();
        img.src = imgElement.src;

        img.addEventListener("load", function() {
          c.width = img.width;
          c.height = img.height;
          ctx.drawImage(img, 0, 0);
          detectObject(model, ctx, img);
        }, false);
      }
    }

    // load the tensorflow model
    async function init() {
      const c = document.getElementById("myCanvas");
      const ctx = c.getContext("2d");
      var img = new Image();
      img.src = IMG_URL;

      img.addEventListener("load", function() {
        c.width = img.width;
        c.height = img.height;
        ctx.drawImage(img, 0, 0);
      }, false);

      model = await loadModel();

      detectObject(model, ctx, img);
    }

    init();
</script>
</html>